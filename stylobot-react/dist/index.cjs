"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const s=require("react/jsx-runtime"),h=require("react");function j(e){return Array.isArray(e)?e.map(j):e!==null&&typeof e=="object"?Object.fromEntries(Object.entries(e).map(([a,n])=>[a.charAt(0).toLowerCase()+a.slice(1),j(n)])):e}function y({apiUrl:e,onDetection:a}){const[n,l]=h.useState(null),[t,c]=h.useState(!0),[d,b]=h.useState(null),o=h.useCallback(async()=>{c(!0),b(null);try{const i=await fetch(e,{credentials:"include",headers:{Accept:"application/json"}});if(!i.ok)throw new Error(`HTTP ${i.status}`);const m=await i.json(),u=j(m);l(u),a==null||a(u)}catch(i){b(i instanceof Error?i.message:"Failed to fetch detection")}finally{c(!1)}},[e,a]);return h.useEffect(()=>{o()},[o]),{data:n,loading:t,error:d,refetch:o}}function g(e){return Array.isArray(e)?e.map(g):e!==null&&typeof e=="object"?Object.fromEntries(Object.entries(e).map(([a,n])=>[a.charAt(0).toLowerCase()+a.slice(1),g(n)])):e}function $({hubUrl:e,signature:a,onUpdate:n}){const[l,t]=h.useState(!1),[c,d]=h.useState(null);return h.useEffect(()=>{const b=window.signalR;if(!(b!=null&&b.HubConnectionBuilder)){d("SignalR not loaded. Include @microsoft/signalr via CDN or npm.");return}const o=new b.HubConnectionBuilder().withUrl(e).withAutomaticReconnect().build();return o.on("BroadcastDetection",i=>{const m=g(i);a&&m.primarySignature!==a||n==null||n(m)}),o.onclose(()=>t(!1)),o.onreconnecting(()=>t(!1)),o.onreconnected(()=>t(!0)),o.start().then(()=>t(!0)).catch(i=>d(i.message)),()=>{o.stop()}},[e,a,n]),{connected:l,error:c}}function S({value:e,size:a=140,label:n}){const l=(a-16)/2,t=a/2,c=a/2+10,d=Math.PI*l,b=d*(1-Math.max(0,Math.min(1,e))),o=Math.round(e*100),i=e>=.7?"var(--sb-danger)":e>=.4?"var(--sb-warning)":"var(--sb-success)";return s.jsxs("div",{className:"sb-gauge",children:[s.jsxs("svg",{width:a,height:a*.65,viewBox:`0 0 ${a} ${a*.65}`,children:[s.jsx("path",{d:`M ${t-l} ${c} A ${l} ${l} 0 0 1 ${t+l} ${c}`,fill:"none",stroke:"var(--sb-border)",strokeWidth:"10",strokeLinecap:"round"}),s.jsx("path",{d:`M ${t-l} ${c} A ${l} ${l} 0 0 1 ${t+l} ${c}`,fill:"none",stroke:i,strokeWidth:"10",strokeLinecap:"round",strokeDasharray:d,strokeDashoffset:b,style:{transition:"stroke-dashoffset 0.8s ease"}})]}),s.jsxs("div",{className:"sb-gauge-value",style:{color:i},children:[o,"%"]}),n&&s.jsx("div",{className:"sb-gauge-label",children:n})]})}const M={VeryLow:"Very Low",Low:"Low",Medium:"Medium",High:"High",VeryHigh:"Very High"};function N({riskBand:e}){const a=`sb-risk-badge sb-risk-${(e||"").toLowerCase()}`;return s.jsx("span",{className:a,children:M[e]||e||"Unknown"})}function k({contributions:e,maxItems:a=5}){if(!(e!=null&&e.length))return null;const n=[...e].sort((t,c)=>Math.abs(c.weightedScore)-Math.abs(t.weightedScore)).slice(0,a),l=Math.max(...n.map(t=>Math.abs(t.weightedScore)),.01);return s.jsxs("div",{className:"sb-detectors",children:[s.jsx("div",{className:"sb-detectors-title",children:"Top Detectors"}),n.map(t=>{const c=Math.abs(t.weightedScore)/l*100,d=t.weightedScore>=0;return s.jsxs("div",{className:"sb-detector-row",children:[s.jsx("span",{className:"sb-detector-name",children:t.name.replace(/Contributor$/,"")}),s.jsx("div",{className:"sb-detector-bar-track",children:s.jsx("div",{className:`sb-detector-bar ${d?"sb-bar-bot":"sb-bar-human"}`,style:{width:`${c}%`}})}),s.jsxs("span",{className:"sb-detector-score",children:[t.weightedScore>=0?"+":"",t.weightedScore.toFixed(2)]})]},t.name)})]})}function f({connected:e}){return s.jsxs("span",{className:`sb-live ${e?"sb-live-active":""}`,children:[s.jsx("span",{className:"sb-live-dot"}),e?"LIVE":"OFFLINE"]})}function B({apiUrl:e,hubUrl:a,theme:n="dark",compact:l=!1,onDetection:t,className:c}){var v;const[d,b]=h.useState(null),o=h.useCallback(w=>{b(w),t==null||t(w)},[t]),{data:i,loading:m,error:u}=y({apiUrl:e,onDetection:t}),{connected:p}=a?$({hubUrl:a,signature:i==null?void 0:i.primarySignature,onUpdate:o}):{connected:!1},r=d||i,x=n==="auto"?"":`sb-theme-${n}`;return m&&!r?s.jsx("div",{className:`sb-widget ${x} ${c||""}`,children:s.jsxs("div",{className:"sb-loading",children:[s.jsx("div",{className:"sb-spinner"}),s.jsx("span",{children:"Analyzing..."})]})}):u&&!r?s.jsx("div",{className:`sb-widget ${x} ${c||""}`,children:s.jsx("div",{className:"sb-error",children:"Detection unavailable"})}):r?l?s.jsx("div",{className:`sb-widget sb-compact ${x} ${c||""}`,children:s.jsxs("div",{className:"sb-compact-row",children:[s.jsx("span",{className:`sb-type-badge ${r.isBot?"sb-is-bot":"sb-is-human"}`,children:r.isBot?"BOT":"HUMAN"}),s.jsxs("span",{className:"sb-compact-prob",children:[Math.round(r.botProbability*100),"%"]}),s.jsx(N,{riskBand:r.riskBand}),r.botName&&s.jsx("span",{className:"sb-compact-name",children:r.botName}),s.jsxs("span",{className:"sb-compact-time",children:[r.processingTimeMs,"ms"]}),a&&s.jsx(f,{connected:p})]})}):s.jsxs("div",{className:`sb-widget ${x} ${c||""}`,children:[s.jsxs("div",{className:"sb-header",children:[s.jsx("span",{className:`sb-type-badge ${r.isBot?"sb-is-bot":"sb-is-human"}`,children:r.isBot?"BOT":"HUMAN"}),s.jsx(N,{riskBand:r.riskBand}),a&&s.jsx(f,{connected:p})]}),s.jsxs("div",{className:"sb-body",children:[s.jsx("div",{className:"sb-gauge-section",children:s.jsx(S,{value:r.botProbability,label:"Bot Probability"})}),s.jsxs("div",{className:"sb-stats",children:[s.jsxs("div",{className:"sb-stat",children:[s.jsx("span",{className:"sb-stat-label",children:"Confidence"}),s.jsxs("span",{className:"sb-stat-value",children:[Math.round(r.confidence*100),"%"]})]}),s.jsxs("div",{className:"sb-stat",children:[s.jsx("span",{className:"sb-stat-label",children:"Detectors"}),s.jsx("span",{className:"sb-stat-value",children:r.detectorsRan})]}),s.jsxs("div",{className:"sb-stat",children:[s.jsx("span",{className:"sb-stat-label",children:"Processing"}),s.jsxs("span",{className:"sb-stat-value",children:[r.processingTimeMs,"ms"]})]}),s.jsxs("div",{className:"sb-stat",children:[s.jsx("span",{className:"sb-stat-label",children:"Action"}),s.jsx("span",{className:"sb-stat-value",children:r.recommendedAction})]}),r.hitCount>0&&s.jsxs("div",{className:"sb-stat",children:[s.jsx("span",{className:"sb-stat-label",children:"Hits"}),s.jsx("span",{className:"sb-stat-value",children:r.hitCount})]}),r.botName&&s.jsxs("div",{className:"sb-stat",children:[s.jsx("span",{className:"sb-stat-label",children:"Bot Name"}),s.jsx("span",{className:"sb-stat-value",children:r.botName})]})]})]}),((v=r.detectorContributions)==null?void 0:v.length)>0&&s.jsx(k,{contributions:r.detectorContributions}),s.jsx("div",{className:"sb-footer",children:s.jsx("span",{className:"sb-brand",children:"stylobot"})})]}):null}exports.DetectorBreakdown=k;exports.LiveIndicator=f;exports.ProbabilityGauge=S;exports.RiskBadge=N;exports.StylobotWidget=B;exports.useDetection=y;exports.useSignalR=$;
