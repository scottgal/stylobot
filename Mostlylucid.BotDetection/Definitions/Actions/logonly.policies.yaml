# Built-in LogOnly action policies
# These define logging and monitoring strategies without blocking

policies:
  logonly:
    type: LogOnly
    description: Minimal logging - shadow mode with basic info
    tags: [default, shadow]
    log_level: Information
    log_full_evidence: false
    add_response_headers: false
    add_to_context_items: true
    would_block_threshold: 0.85

  shadow:
    type: LogOnly
    extends: logonly
    description: Shadow mode with response headers for debugging
    tags: [production, shadow, headers]
    add_response_headers: true
    include_detailed_headers: false

  debug:
    type: LogOnly
    extends: logonly
    description: Full debug logging with all evidence and headers
    tags: [development, debug]
    log_level: Debug
    log_full_evidence: true
    add_response_headers: true
    include_detailed_headers: true

  full-log:
    type: LogOnly
    extends: debug
    description: Maximum visibility - debug logging with all response headers. Great for demos.
    tags: [demo, debug, development]
    log_level: Debug
    log_full_evidence: true
    add_response_headers: true
    include_detailed_headers: true
    add_to_context_items: true
    would_block_threshold: 0.7

  shadow-production:
    type: LogOnly
    extends: logonly
    description: Production shadow mode - logs what WOULD be blocked without blocking. No headers exposed.
    tags: [production, shadow, testing]
    log_level: Information
    log_full_evidence: false
    add_response_headers: false
    add_to_context_items: true
    would_block_threshold: 0.7
    metric_name: bot_detection_shadow

  log-to-file:
    type: LogOnly
    extends: logonly
    description: Writes detection events to JSON Lines files for playback and forensic analysis
    tags: [production, audit, forensics]
    log_level: Information
    log_full_evidence: true
    add_to_context_items: true
    log_directory: logs/bot-detection
    log_file_pattern: detections-{date}.jsonl
    log_only_bots: true
    log_min_confidence: 0.5
    log_retain_files: 30

  forward-to-honeypot:
    type: LogOnly
    extends: logonly
    description: Forwards detection data to honeypot/trap service. Detection runs, request passes through.
    tags: [honeypot, security, research]
    log_level: Debug
    log_full_evidence: true
    add_to_context_items: true
    forward_url: http://honeypot:8080/trap
    forward_method: POST
    forward_timeout_ms: 5000
    forward_async: true
    forward_include_headers: true
    forward_include_reasons: true

  forward-to-analytics:
    type: LogOnly
    extends: logonly
    description: Fire-and-forget forwarding to SIEM/analytics endpoint
    tags: [analytics, siem, monitoring]
    log_level: Information
    add_to_context_items: true
    forward_url: http://analytics:9000/events/bot-detection
    forward_method: POST
    forward_async: true
    forward_include_headers: false
    forward_include_reasons: true

  degrade:
    type: LogOnly
    description: Mark request for content degradation — downstream reads BotDetection.Action=degrade from HttpContext.Items
    tags: [production, stealth, degradation]
    log_level: Information
    log_full_evidence: false
    add_response_headers: false
    add_to_context_items: true

  rate-limit-headers:
    type: LogOnly
    description: Add RateLimit-* response headers without blocking — signals to well-behaved bots
    tags: [production, rate-limiting, headers]
    log_level: Information
    log_full_evidence: false
    add_response_headers: true
    include_detailed_headers: false

  quarantine:
    type: LogOnly
    description: Allow request through but tag for manual review downstream
    tags: [production, review, quarantine]
    log_level: Warning
    log_full_evidence: true
    add_response_headers: false
    add_to_context_items: true

  sandbox:
    type: LogOnly
    description: >
      Probation mode — forces the full learning detection policy on uncertain
      traffic to build confidence before taking definitive action. All detectors
      run on every request. LLM sampling (default 5%) gives high-confidence
      verdicts on a fraction of requests without the latency cost on all of them.
      Reputations decay naturally, so sandbox is never permanent — avoids
      false positives/negatives lasting forever.
    tags: [production, probation, sandbox, deep-analysis]
    log_level: Warning
    log_full_evidence: true
    add_response_headers: false
    add_to_context_items: true

  mask-pii:
    type: LogOnly
    description: >
      Allow request through but stream-mask response PII using Microsoft Recognizers.
      Intended for high-confidence malicious traffic that is not hard-blocked.
    tags: [production, privacy, response-mutation]
    log_level: Warning
    log_full_evidence: true
    add_response_headers: false
    add_to_context_items: true

  strip-pii:
    type: LogOnly
    extends: mask-pii
    description: Alias of mask-pii.
    tags: [production, privacy, response-mutation, alias]

  passthrough-internal:
    type: LogOnly
    extends: logonly
    description: Allows known-good traffic through while still logging. Use for false positive exceptions.
    tags: [internal, exceptions, false-positives]
    log_level: Information
    log_full_evidence: true
    add_to_context_items: true
    passthrough_user_agents:
      - "InternalMonitor/.*"
      - "HealthCheck/.*"
    passthrough_ips:
      - "10.0.0.0/8"
      - "192.168.0.0/16"
      - "172.16.0.0/12"
