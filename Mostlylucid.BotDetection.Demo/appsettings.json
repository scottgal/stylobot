{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning",
      "Mostlylucid.BotDetection": "Debug",
      "Mostlylucid.BotDetection.Services.BotListUpdateService": "Information"
    }
  },
  "AllowedHosts": "*",
  "MockLlmApi": {
    "BaseUrl": "http://localhost:11434/v1/",
    "ModelName": "gemma3:4b",
    "Temperature": 0.7
  },
  "BotDetection": {
    "BotThreshold": 0.7,
    "EnableTestMode": true,
    "ExcludedPaths": [
      "/health",
      "/metrics",
      "/api/mock"
    ],
    "TestModeSimulations": {
      "human": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
      "googlebot": "Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)",
      "bingbot": "Mozilla/5.0 (compatible; bingbot/2.0; +http://www.bing.com/bingbot.htm)",
      "scrapy": "Scrapy/2.11 (+https://scrapy.org)",
      "curl": "curl/8.4.0",
      "puppeteer": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/120.0.0.0 Safari/537.36",
      "malicious": "sqlmap/1.7 (http://sqlmap.org)",
      "gptbot": "Mozilla/5.0 AppleWebKit/537.36 (KHTML, like Gecko; compatible; GPTBot/1.0; +https://openai.com/gptbot)",
      "claudebot": "ClaudeBot/1.0; +https://anthropic.com",
      "twitterbot": "Twitterbot/1.0",
      "facebookbot": "facebookexternalhit/1.1 (+http://www.facebook.com/externalhit_uatext.php)",
      "uptimerobot": "UptimeRobot/2.0; +http://www.uptimerobot.com/",
      "nikto": "Mozilla/5.00 (Nikto/2.1.6) (Evasions:None) (Test:Port Check)",
      "nessus": "Nessus SOAP",
      "nmap": "Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)",
      "burpsuite": "Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 Burp/2023.10",
      "acunetix": "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) Acunetix Web Vulnerability Scanner",
      "honeypot-harvester": "<test-honeypot:harvester>",
      "honeypot-spammer": "<test-honeypot:spammer>",
      "honeypot-suspicious": "<test-honeypot:suspicious>"
    },
    "PathPolicies": {
      "/bot-detection/*": "full-demo",
      "/bot-test": "full-demo",
      "/api/*": "full-demo",
      "/*": "full-demo"
    },
    "_policiesDocumentation": {
      "_comment": "POLICY CONFIGURATION GUIDE",
      "_fastPath": "Static detectors that run sync: UserAgent, Header, Ip, Behavioral, ClientSide, Inconsistency, VersionAge",
      "_aiPath": "AI detectors for sync decisions: Heuristic (fast ~1ms), Llm (slow ~500ms+). Add any registered AI detector.",
      "_learning": "When EscalateToAi=false, uncertain requests are queued for async learning with full AI pipeline.",
      "_example_noAi": "FastPath=[...], AiPath=[], EscalateToAi=false -> static only, async learning",
      "_example_heuristic": "FastPath=[...], AiPath=['Heuristic'], EscalateToAi=true -> static + Heuristic sync",
      "_example_full": "FastPath=[], AiPath=[], BypassTriggerConditions=true -> run ALL registered detectors"
    },
    "Policies": {
      "default": {
        "Description": "RECOMMENDED - All detectors + Heuristic in FastPath, LLM→HeuristicLate in AiPath",
        "FastPath": [
          "FastPathReputation",
          "HoneypotLink",
          "UserAgent",
          "Header",
          "Ip",
          "SecurityTool",
          "ProjectHoneypot",
          "CacheBehavior",
          "Behavioral",
          "AdvancedBehavioral",
          "ClientSide",
          "Inconsistency",
          "VersionAge",
          "ReputationBias",
          "Heuristic"
        ],
        "SlowPath": [],
        "AiPath": [
          "Llm",
          "HeuristicLate"
        ],
        "UseFastPath": true,
        "ForceSlowPath": false,
        "EscalateToAi": true,
        "AiEscalationThreshold": 0.0,
        "EarlyExitThreshold": 0.85,
        "ImmediateBlockThreshold": 0.95,
        "Tags": [
          "production",
          "all-detectors",
          "heuristic",
          "llm"
        ],
        "Transitions": [
          {
            "WhenRiskExceeds": 0.5,
            "WhenRiskBelow": 0.95,
            "ActionPolicyName": "holodeck",
            "Description": "Medium-high risk - redirect to holodeck for study"
          },
          {
            "WhenRiskExceeds": 0.95,
            "ActionPolicyName": "block",
            "Description": "Verified bad - block"
          }
        ]
      },
      "fastpath": {
        "Description": "FAST - All detectors + Heuristic, no LLM, escalates to default when uncertain",
        "FastPath": [
          "FastPathReputation",
          "UserAgent",
          "Header",
          "Ip",
          "SecurityTool",
          "ProjectHoneypot",
          "CacheBehavior",
          "Behavioral",
          "AdvancedBehavioral",
          "ClientSide",
          "Inconsistency",
          "VersionAge",
          "ReputationBias",
          "Heuristic"
        ],
        "SlowPath": [],
        "AiPath": [],
        "UseFastPath": true,
        "ForceSlowPath": false,
        "EscalateToAi": false,
        "AiEscalationThreshold": 0.0,
        "EarlyExitThreshold": 0.15,
        "ImmediateBlockThreshold": 0.90,
        "Tags": [
          "production",
          "all-detectors",
          "heuristic-only"
        ],
        "_weightsNote": "ClientSide weight lowered for demo - real browser fingerprint would override simulated UA.",
        "Weights": {
          "ClientSide": 0.2
        },
        "Transitions": [
          {
            "WhenRiskExceeds": 0.5,
            "WhenRiskBelow": 0.85,
            "GoTo": "default",
            "Description": "Uncertain zone - escalate to LLM"
          }
        ]
      },
      "learning": {
        "Description": "ASYNC LEARNING - full pipeline with all registered AI detectors, never blocks",
        "FastPath": [
          "FastPathReputation",
          "UserAgent",
          "Header",
          "Ip",
          "SecurityTool",
          "ProjectHoneypot",
          "CacheBehavior",
          "Behavioral",
          "AdvancedBehavioral",
          "ClientSide",
          "Inconsistency",
          "VersionAge",
          "ReputationBias"
        ],
        "SlowPath": [
          "Heuristic"
        ],
        "AiPath": [
          "Llm",
          "HeuristicLate"
        ],
        "UseFastPath": false,
        "ForceSlowPath": true,
        "EscalateToAi": true,
        "AiEscalationThreshold": 0.0,
        "EarlyExitThreshold": 0.0,
        "ImmediateBlockThreshold": 1.0,
        "BypassTriggerConditions": true,
        "TimeoutSeconds": 10,
        "Tags": [
          "async",
          "learning",
          "full-pipeline",
          "never-blocks"
        ]
      },
      "realfast": {
        "Description": "REAL FAST - Production mode that BLOCKS bots. Shows what users would actually see.",
        "FastPath": [
          "FastPathReputation",
          "UserAgent",
          "Header",
          "Ip",
          "SecurityTool",
          "ProjectHoneypot",
          "CacheBehavior",
          "Behavioral",
          "AdvancedBehavioral",
          "ClientSide",
          "Inconsistency",
          "VersionAge",
          "ReputationBias",
          "Heuristic"
        ],
        "SlowPath": [],
        "AiPath": [],
        "UseFastPath": true,
        "ForceSlowPath": false,
        "EscalateToAi": false,
        "AiEscalationThreshold": 0.0,
        "EarlyExitThreshold": 0.85,
        "ImmediateBlockThreshold": 0.70,
        "DefaultBlockAction": "Challenge",
        "Tags": [
          "production",
          "blocking",
          "real-experience"
        ]
      },
      "demo": {
        "Description": "DEMO - full pipeline sync for demonstration (Heuristic Wave 1, dual LLM Wave 2 in parallel)",
        "FastPath": [
          "FastPathReputation",
          "UserAgent",
          "Header",
          "Ip",
          "SecurityTool",
          "ProjectHoneypot",
          "CacheBehavior",
          "Behavioral",
          "AdvancedBehavioral",
          "ClientSide",
          "Inconsistency",
          "VersionAge",
          "ReputationBias"
        ],
        "SlowPath": [
          "Heuristic"
        ],
        "AiPath": [
          "Llm",
          "HeuristicLate"
        ],
        "UseFastPath": false,
        "ForceSlowPath": true,
        "EscalateToAi": true,
        "AiEscalationThreshold": 0.0,
        "EarlyExitThreshold": 0.0,
        "ImmediateBlockThreshold": 1.0,
        "BypassTriggerConditions": true,
        "TimeoutSeconds": 20,
        "Tags": [
          "demo",
          "sync",
          "full-pipeline"
        ]
      },
      "uaonly": {
        "Description": "UA ONLY - User-Agent based detection only (fastest, for UA string testing)",
        "FastPath": [
          "UserAgent",
          "SecurityTool",
          "VersionAge"
        ],
        "SlowPath": [],
        "AiPath": [],
        "UseFastPath": true,
        "ForceSlowPath": false,
        "EscalateToAi": false,
        "EarlyExitThreshold": 0.0,
        "ImmediateBlockThreshold": 1.0,
        "Tags": [
          "ua-only",
          "fastest",
          "testing"
        ]
      },
      "full-demo": {
        "Description": "FULL DEMO - ALL non-AI detectors enabled for comprehensive signature display",
        "FastPath": [
          "FastPathReputation",
          "HoneypotLink",
          "UserAgent",
          "Header",
          "Ip",
          "SecurityTool",
          "ProjectHoneypot",
          "CacheBehavior",
          "Behavioral",
          "AdvancedBehavioral",
          "ClientSide",
          "Inconsistency",
          "VersionAge",
          "ReputationBias",
          "Heuristic",
          "TlsFingerprint",
          "TcpIpFingerprint",
          "Http2Fingerprint",
          "MultiLayerCorrelation",
          "BehavioralWaveform",
          "ResponseBehavior"
        ],
        "SlowPath": [],
        "AiPath": [],
        "UseFastPath": true,
        "ForceSlowPath": false,
        "EscalateToAi": false,
        "AiEscalationThreshold": 0.0,
        "EarlyExitThreshold": 0.0,
        "ImmediateBlockThreshold": 1.0,
        "BypassTriggerConditions": true,
        "Tags": [
          "demo",
          "all-detectors",
          "no-ai",
          "full-fingerprinting"
        ]
      }
    },
    "EnableUserAgentDetection": true,
    "EnableHeaderAnalysis": true,
    "EnableIpDetection": true,
    "EnableBehavioralAnalysis": true,
    "EnableLlmDetection": true,
    "ResponseHeaders": {
      "Enabled": true,
      "HeaderPrefix": "X-Bot-",
      "IncludePolicyName": true,
      "IncludeConfidence": true,
      "IncludeDetectors": true,
      "IncludeProcessingTime": true,
      "IncludeBotName": true,
      "IncludeFullJson": false
    },
    "YarpLearningMode": {
      "Enabled": true,
      "OutputPath": "./yarp-learning-data",
      "FileFormat": "jsonl",
      "LogToConsole": true,
      "MinConfidenceToLog": 0.0,
      "IncludeLlmDetector": false,
      "IncludeOnnxDetector": true,
      "SamplingRate": 1.0,
      "BufferSize": 10,
      "IncludeFullHttpContext": false,
      "IncludeRequestBody": false,
      "IncludeDetectorOutputs": true,
      "IncludeBlackboardSignals": true,
      "UseTimestampedFiles": true,
      "ExcludePaths": [
        "/health",
        "/healthz",
        "/ping",
        "/metrics"
      ],
      "Rotation": {
        "MaxSizeBytes": 10485760,
        "MaxAgeHours": 1,
        "MaxFiles": 5
      }
    },
    "FastPath": {
      "Enabled": true,
      "MaxParallelDetectors": 50,
      "EnableWaveParallelism": true,
      "WaveTimeoutMs": 2000,
      "FastPathTimeoutMs": 5000,
      "EarlyExitThreshold": 0.99,
      "SkipSlowPathThreshold": 0.0,
      "SlowPathTriggerThreshold": 0.0,
      "AlwaysRunFullOnPaths": [
        "/bot-test"
      ],
      "SlowPathDetectors": [
        {
          "Name": "Heuristic Detector",
          "Signal": "AiClassificationCompleted",
          "ExpectedLatencyMs": 1,
          "Wave": 1,
          "Category": "AI",
          "Weight": 2.0
        },
        {
          "Name": "LLM Detector",
          "Signal": "LlmClassificationCompleted",
          "ExpectedLatencyMs": 500,
          "Wave": 2,
          "Category": "AI",
          "Weight": 2.5
        },
        {
          "Name": "Inconsistency Detector",
          "Signal": "InconsistencyUpdated",
          "ExpectedLatencyMs": 2,
          "Wave": 1,
          "Category": "Inconsistency",
          "Weight": 1.5
        },
        {
          "Name": "Version Age Detector",
          "Signal": "VersionAgeAnalyzed",
          "ExpectedLatencyMs": 1,
          "Wave": 1,
          "Category": "VersionAge",
          "Weight": 1.0
        }
      ],
      "_signatureMatchingDocumentation": {
        "_comment": "NEW - Multi-factor signature matching weights for first-hit detection",
        "_serverSide": "Primary (IP+UA 100%), IP (50%), UA (50%), IPSubnet (30%)",
        "_clientSide": "ClientSide (Canvas+WebGL 80%), Plugin (Fonts+Extensions 60%) - via postback",
        "_matching": "Require Primary OR IP+UA OR 2+ factors ≥100% OR 3+ factors ≥80%",
        "_falsePositivePrevention": "Guards against same office/network false matches"
      },
      "SignatureMatching": {
        "WeightPrimary": 100.0,
        "WeightIp": 50.0,
        "WeightUa": 50.0,
        "WeightIpSubnet": 30.0,
        "WeightClientSide": 80.0,
        "WeightPlugin": 60.0,
        "MinWeightForMatch": 100.0,
        "MinWeightForWeakMatch": 80.0,
        "MinFactorsForWeakMatch": 3
      }
    },
    "VersionAge": {
      "Enabled": true,
      "CheckBrowserVersion": true,
      "CheckOsVersion": true,
      "MaxBrowserVersionAge": 10
    },
    "AiDetection": {
      "Provider": "Heuristic",
      "TimeoutMs": 15000,
      "MaxConcurrentRequests": 5,
      "Ollama": {
        "Endpoint": "http://localhost:11434",
        "Model": "gemma3:4b",
        "UseJsonMode": true
      },
      "Heuristic": {
        "Enabled": true,
        "LoadLearnedWeights": true,
        "EnableWeightLearning": true,
        "MinConfidenceForLearning": 0.8,
        "LearningRate": 0.01,
        "WeightReloadIntervalMinutes": 60
      }
    },
    "MaxRequestsPerMinute": 60,
    "CacheDurationSeconds": 0,
    "EnableBackgroundUpdates": true,
    "UpdateIntervalHours": 24,
    "StartupDelaySeconds": 2,
    "LogDetailedReasons": true,
    "LogPerformanceMetrics": true,
    "_updateScheduleDocumentation": {
      "_comment": "NEW - Cron-based bot list update scheduler (replaces UpdateIntervalHours)",
      "_cronExamples": "0 2 * * * (daily 2AM), 0 */6 * * * (every 6h), */30 * * * * (every 30min)",
      "_note": "UpdateIntervalHours is deprecated - use UpdateSchedule.cron instead"
    },
    "UpdateSchedule": {
      "cron": "0 2 * * *",
      "timezone": "UTC",
      "signal": "botlist.update",
      "runOnStartup": true,
      "maxExecutionSeconds": 300,
      "description": "Daily bot list update at 2 AM UTC"
    },
    "SecurityTools": {
      "Enabled": true,
      "BlockSecurityTools": true,
      "LogDetections": true,
      "CustomPatterns": [],
      "ExcludedPatterns": [],
      "EnabledCategories": [],
      "HoneypotRedirectUrl": null
    },
    "Holodeck": {
      "MockApiBaseUrl": "http://localhost:5080/api/mock",
      "Mode": "RealisticButUseless",
      "ContextSource": "Fingerprint",
      "MaxStudyRequests": 50,
      "MockApiTimeoutMs": 5000,
      "EnableHoneypotLinkDetection": true,
      "HoneypotPaths": [
        "/admin-secret",
        "/wp-login.php",
        "/.env",
        "/config.php",
        "/.git/config",
        "/phpmyadmin",
        "/backup.sql"
      ],
      "ReportToProjectHoneypot": false,
      "ProjectHoneypotAccessKey": null,
      "MinRiskToReport": 0.85,
      "MaxReportsPerHour": 100
    },
    "ProjectHoneypot": {
      "Enabled": true,
      "AccessKey": null,
      "HighThreatThreshold": 25,
      "MaxDaysAge": 90,
      "TimeoutMs": 1000,
      "CacheDurationSeconds": 1800,
      "SkipLocalIps": true,
      "TreatHarvestersAsMalicious": true,
      "TreatCommentSpammersAsMalicious": true,
      "TreatSuspiciousAsSuspicious": true
    },
    "Behavioral": {
      "ApiKeyHeader": "X-Api-Key",
      "ApiKeyRateLimit": 120,
      "UserIdHeader": "X-User-Id",
      "UserIdClaim": "sub",
      "UserRateLimit": 180,
      "EnableAnomalyDetection": true,
      "SpikeThresholdMultiplier": 5.0,
      "NewPathAnomalyThreshold": 0.8
    },
    "ClientSide": {
      "Enabled": true,
      "TokenSecret": "demo-secret-key-change-in-production",
      "TokenLifetimeSeconds": 300,
      "FingerprintCacheDurationSeconds": 1800,
      "CollectWebGL": true,
      "CollectCanvas": true,
      "MinIntegrityScore": 70,
      "HeadlessThreshold": 0.5
    },
    "_dataSourcesDocumentation": {
      "_comment": "NEW - Per-source update schedules allow different update frequencies",
      "_global": "Global UpdateSchedule applies to all sources by default",
      "_override": "Set UpdateSchedule on individual sources to override global schedule",
      "_examples": {
        "_awsIps": "Every 6 hours (IP ranges change frequently)",
        "_securityTools": "Every 2 hours (critical, detect new threats fast)",
        "_botPatterns": "Daily at 3 AM (patterns change less frequently)",
        "_browserVersions": "Weekly (version numbers update slowly)"
      }
    },
    "DataSources": {
      "IsBot": {
        "Enabled": true,
        "Url": "https://raw.githubusercontent.com/omrilotan/isbot/main/src/patterns.json",
        "Description": "IsBot comprehensive bot regex patterns (JSON array)",
        "UpdateSchedule": {
          "cron": "0 3 * * *",
          "timezone": "UTC",
          "signal": "botlist.isbot.updated",
          "runOnStartup": true,
          "description": "Daily IsBot patterns update at 3 AM UTC"
        }
      },
      "Matomo": {
        "Enabled": false,
        "Url": "https://raw.githubusercontent.com/matomo-org/device-detector/master/regexes/bots.yml",
        "Description": "Matomo categorized bot patterns (YAML)"
      },
      "CrawlerUserAgents": {
        "Enabled": false,
        "Url": "https://raw.githubusercontent.com/monperrus/crawler-user-agents/master/crawler-user-agents.json",
        "Description": "Community crawler patterns (JSON)"
      },
      "AwsIpRanges": {
        "Enabled": true,
        "Url": "https://ip-ranges.amazonaws.com/ip-ranges.json",
        "Description": "AWS official IP ranges (JSON, ~2MB)",
        "UpdateSchedule": {
          "cron": "0 */6 * * *",
          "timezone": "UTC",
          "signal": "botlist.aws.updated",
          "runOnStartup": true,
          "maxExecutionSeconds": 120,
          "description": "AWS IP ranges every 6 hours (changes frequently)"
        }
      },
      "GcpIpRanges": {
        "Enabled": true,
        "Url": "https://www.gstatic.com/ipranges/cloud.json",
        "Description": "Google Cloud IP ranges (JSON)",
        "UpdateSchedule": {
          "cron": "30 */6 * * *",
          "timezone": "UTC",
          "signal": "botlist.gcp.updated",
          "runOnStartup": true,
          "description": "GCP IP ranges every 6 hours, offset 30min from AWS"
        }
      },
      "AzureIpRanges": {
        "Enabled": false,
        "Url": "",
        "Description": "Azure IP ranges (URL changes weekly, manual update required)"
      },
      "CloudflareIpv4": {
        "Enabled": true,
        "Url": "https://www.cloudflare.com/ips-v4",
        "Description": "Cloudflare IPv4 ranges (text)",
        "UpdateSchedule": {
          "cron": "0 4 * * *",
          "timezone": "UTC",
          "signal": "botlist.cloudflare.updated",
          "runOnStartup": true,
          "description": "Cloudflare IPv4 daily at 4 AM UTC"
        }
      },
      "CloudflareIpv6": {
        "Enabled": true,
        "Url": "https://www.cloudflare.com/ips-v6",
        "Description": "Cloudflare IPv6 ranges (text)",
        "UpdateSchedule": {
          "cron": "0 4 * * *",
          "timezone": "UTC",
          "signal": "botlist.cloudflare.updated",
          "runOnStartup": true,
          "description": "Cloudflare IPv6 daily at 4 AM UTC"
        }
      },
      "ScannerUserAgents": {
        "Enabled": true,
        "Url": "https://raw.githubusercontent.com/digininja/scanner_user_agents/main/list.json",
        "Description": "Security scanner user agents (JSON) - Nikto, SQLMap, etc.",
        "UpdateSchedule": {
          "cron": "0 */2 * * *",
          "timezone": "UTC",
          "signal": "botlist.scanners.updated",
          "runOnStartup": true,
          "description": "Security tools every 2 hours (critical threat detection)"
        }
      },
      "CoreRuleSetScanners": {
        "Enabled": true,
        "Url": "https://raw.githubusercontent.com/coreruleset/coreruleset/main/rules/scanners-user-agents.data",
        "Description": "OWASP CoreRuleSet scanner patterns (text)",
        "UpdateSchedule": {
          "cron": "15 */2 * * *",
          "timezone": "UTC",
          "signal": "botlist.owasp.updated",
          "runOnStartup": true,
          "description": "OWASP patterns every 2 hours, offset 15min from scanners"
        }
      }
    }
  }
}
